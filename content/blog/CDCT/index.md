---
title: Consumer Driven Contract Testing and the Problem it is solving/not solving
date: 2020-04-10 19:40:00 +0300
description: # Add post description (optional)
img: ./js-1.png # Add image post (optional)
tags: [] # add tag
---

It was long ago when I first heard the hype on CDC Testing, but I have not had chance to explore as much as I wanted to or any chance to apply this technology to the systems I worked with.

I have been exploring contract testing and specifically consumer driven contract testing for some weeks now and in this article I aim to provide my insights on the suitability of this approach on major systems and talk about pros ,cons.

First lets define it, Consumer driven contract tests are tests that are defined by consumers's description of what an interaction(response)  should be via contract(s)(nothing but a json file in essense) and the provider fetches that contract and ensure it meets it. So there are two sides of the coin, 1)consumer 2) provider , consumers outlines contracts and provider have to meet the contracts ,otherwise the change is rejected well BEFORE the deployment. As can be seen this methodology is proactive about the changes that are happening and blocks it if it will break any of the consumers demands (contract) thus guards the production deployment going wrong. So conclusively, if there are any systems where provider can make changes and deploy it regardless of what the consumer contract is ,then it is pointless to apply CDCT here (i.e a systems where you test an external API endpoint, most of the time you can not dictate an external api provider to meet your contract if they are generic providers, and not just serving you) The whole point is to catch the change that will upset some or all of the consumers in advance so that consuming system will not suffer.

Mainly , contract testing can be applied to all below systems/architectures. I will  go through one by one;

### A) API Systems
  API tests are able to test API level code already so why would we even consider taking some of these out and instead apply CDCT ? Well, if you have only one consumer it is less necassary (even in that case , it is useful)but if you have multiple consumers consuming the api, one small change to one of the endpoints might work for 999 consumers but 1 can fail, thus CDCT puts C on the steering wheel instead and avoids this problem. Also we might just need to check the API request and response in our API test instead of some business logic and CDCT just does that, it wont be interested in if the API endpoint does the operation correctly but it will be interested the format of the Request and Response and the data that is returned and for API tests that is what we want to achieve most of the time, but if the provider of the API is not within the same organisation CDCT can become obsolete easily.

### B) Microservices Architectures
   In my observation CDCT proves to be most useful in Microservices architectures where there are always multiple consumers of services and there are bunch of small services that need to communicate/coordinate with each other to achieve the goal of the business. Main reason for this usefulness is that it is vital to know the impact of the change of one microservice in advance so that deployment with a major bug does not go ahead (especially it is very hard to detect this impact as you will have a number of small unit of services running in the background and exchange data) and all services are ensured to work together in their relative versions with the change seamlessly well ahead of time of deployment. Since the communication of microservices is via endpoint calls, it fits the bill for CDCT. One challenge of this testing approach for microservices though is managing to identify all consumers and providers in the whole system and know the relation of each service with one another alongside with the correct versions and write consumer tests accordingly so analyses part plays a huge role here and again require the whole team's focus on implementing CDCT.

### C) ML models
   Machine learning model testing is tricky because the output of the model is very driven by the data utilised and accuracy is never %100 and the model has a probabilistic accuracy. Models are also very context driven so traditional tests where you strictly expect an outcome won't work here as they are probabilistic and data driven.Because ML models can be called by external systems via an API endpoint, we can very well define what we will ask of and expect from the model in terms of the format so CDCT can be utilized to ensure the format of the request,response returned and again although it won't measure how good the model predicts it will ensure the change made to the model won't break the consuming systems. 

In the light of the investigation,I found CBCT quiet useful and provides a solution to the communication problem of different systems but I also think the implementation is not straightforward and it takes time to digest this way of implementing tests and proper planning of pipelines, pact brokers,contract frameworks is crucial otherwise you risk failure and whole team needs to be on the same page to apply the rules of CBCT in an agreed/planned fashion as well and it might require convincing and habit change on the whole team. There are also some supplementary products that can accompany and help with CBCT implementation, one product I checked out is pactflow.io , it is an online pact broker where it has a user friendly UI where you can see all of your consumers ,versions, contracts and providers and identify various versions of consumers and providers working together. This is very important because once you start adding more consumers and providers into your environment it will be challenging to track which provider working with which consumer etc.. so I would also recommend it otherwise you will have to do it yourself which might require dedicating server for a broker and all of that devops stuff(dockers, containers etc..) which will be challenging to do for a team alone most of the time.So don't re-invent the wheel and be mindful about what your goal is.

I also aim to put some code examples to show a small demo of CBCT on a .net core web api project.Check here for the sample soon: http://www.github.com/dikili/cdct
